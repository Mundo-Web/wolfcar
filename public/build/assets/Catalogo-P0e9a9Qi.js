import{R as r,r as s}from"./FilterContainer-TykbAVkI.js";import{c as T}from"./ReactAppend-GBOQKLDe.js";import{C as O}from"./CreateReactScript-Il069F1S.js";import{F as C,P as z,a as H}from"./ProductCard-0T5iLCpj.js";import"./SelectAPIFormGroup-A251JnnE.js";import{a as q}from"./arrayJoin-Fk5sgFcM.js";import{a as h}from"./axios-_sX4vCAy.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-Hm6EbMAE.js";import"./TippyButton-w0wM3ydO.js";const J=({minPrice:d,maxPrice:m,categories:x,tags:b,attribute_values:N,id_cat:c,tag_id:_,subCatId:v})=>{const[j,F]=s.useState([]),[e,f]=s.useState({}),[p,S]=s.useState(0),[n,E]=s.useState(1),[M,y]=s.useState(!1),w=s.useRef(!1),g=s.useRef(null);s.useEffect(()=>{const a=document.createElement("script");return a.src="js/notify.extend.min.js",a.async=!0,document.body.appendChild(a),()=>{document.body.removeChild(a)}},[]),s.useEffect(()=>{const a=new URLSearchParams(window.location.search),t=a.get("tag");a.get("category");const i=a.get("att"),o={};t&&(o["txp.tag_id"]=[t]),c&&(o.category_id=[c]),i&&(o.attribute_value_id=[i]),f(u=>JSON.stringify(u)!==JSON.stringify(o)?o:u)},[c]),console.log(e,"attribute_value_id"),s.useEffect(()=>{E(1),P()},[e]),s.useEffect(()=>{P()},[n]),s.useEffect(()=>{v!==null&&f({...e,subcategory_id:[v]})},[]);const P=async()=>{g.current&&g.current.cancel("Operation canceled due to new request."),g.current=h.CancelToken.source();const a=[];if((e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?a.push([[["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]],"and",[["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]]]):e.minPrice?a.push([["precio",">=",e.minPrice],"or",[["descuento",">=",e.minPrice],"and",["descuento","<>",0]]]):e.maxPrice&&a.push([["precio","<=",e.maxPrice],"or",[["descuento","<=",e.maxPrice],"and",["descuento","<>",0]]])),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const t=[];e["txp.tag_id"].forEach((i,o)=>{o===0?t.push(["txp.tag_id","=",i]):t.push("or",["txp.tag_id","=",i])}),a.push(t)}for(const t in e){if(!t.startsWith("attribute-")||e[t].length===0)continue;const[,i]=t.split("-"),o=[];e[t].forEach((u,R)=>{R===0?o.push(["apv.attribute_value_id","=",u]):o.push("or",["apv.attribute_value_id","=",u])}),a.push([["a.id","=",i],"and",o])}if(e.attribute_value_id&&e.attribute_value_id.length>0&&e.attribute_value_id.forEach((t,i)=>{i===0?a.push(["apv.attribute_value_id","=",t]):a.push("or",["apv.attribute_value_id","=",t])}),e.category_id&&e.category_id.length>0){const t=[];e.category_id.forEach((i,o)=>{o===0?t.push(["categoria_id","=",i]):t.push("or",["categoria_id","=",i])}),a.push(t)}if(e.subcategory_id&&e.subcategory_id.length>0){const t=[];e.subcategory_id.forEach((i,o)=>{o===0?t.push(["subcategory_id","=",i]):t.push("or",["subcategory_id","=",i])}),a.push(t)}try{const{status:t,data:i}=await h.post("/api/products/paginate",{requireTotalCount:!0,filter:q([...a,["products.visible","=",!0]],"and"),take:12,skip:12*(n-1)},{headers:{"Content-Type":"application/json"},cancelToken:g.current.token});w.current=(i==null?void 0:i.is_proveedor)??!1,F((i==null?void 0:i.data)??[]),S((i==null?void 0:i.totalCount)??0)}catch(t){h.isCancel(t)?console.log("Request canceled",t.message):console.error(t)}},k=N.reduce((a,t)=>(a[t.attribute_id]||(a[t.attribute_id]=[]),a[t.attribute_id].push(t),a),{}),l=x.find(a=>a.id===Number(c));return console.log(l),r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("section",{class:"flex relative flex-col justify-center items-center px-[5%] py-28 text-base font-medium min-h-[345px] text-neutral-900 max-md:py-24"},r.createElement("img",{loading:"lazy",src:"https://cdn.builder.io/api/v1/image/assets/TEMP/1f15375dac970433a2abe3921fa2c31e35c32f7b26a37b841431aaba1861d380?placeholderIfAbsent=true&apiKey=72fae0f4c808496790606e16dad566da",alt:"",class:"object-cover absolute inset-0 size-full opacity-15"}),r.createElement("div",{class:"flex relative flex-col max-w-full w-[499px]"},r.createElement("h2",{class:"self-center text-[#FD1F4A] font-Helvetica_Medium"},"Catálogo"),r.createElement("h3",{class:"mt-3 text-5xl text-center max-md:max-w-full font-Helvetica_Medium"},(l==null?void 0:l.name)??"Todas las categorías"),r.createElement("p",{class:"mt-3 text-lg font-light text-center max-md:max-w-full "},(l==null?void 0:l.description)??"Explora nuestro catálogo completo de productos cuidadosamente seleccionados para ofrecerte la mejor calidad y variedad."))),r.createElement("form",{className:"flex flex-col lg:flex-row gap-6  mx-auto font-Helvetica_Light font-bold w-full p-5 lg:p-10"},r.createElement("section",{className:"hidden lg:flex md:flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max top-2"},r.createElement(C,{setFilter:f,filter:e,minPrice:d??0,maxPrice:m??0,categories:x,tags:b,attribute_values:Object.values(k),selected_category:c,tag_id:_})),r.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},r.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},r.createElement("div",{className:"flex flex-col xl:flex-row  justify-start xl:justify-between items-start gap-2 "},r.createElement("span",{className:"font-normal text-[17px] text-[#666666] xl:ml-3"},"Mostrando ",(n-1)*12+1," - ",n*12>p?p:n*12," de ",p," resultados"),r.createElement("button",{type:"button",className:"lg:hidden text-[#006BF6]",onClick:()=>y(!0)}," Mostrar Filtros"))),r.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3 gap-4 md:pr-4"},j.map((a,t)=>r.createElement(z,{key:`product-${a.id}`,item:a,bgcolor:"bg-white",is_reseller:w.current}))),r.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},r.createElement(H,{current:n,setCurrent:E,pages:Math.ceil(p/12)}))),M&&r.createElement("div",{className:"fixed z-40 top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center max-h-[80vh] p-5",id:"modal"},r.createElement("div",{className:"z-50 flex items-center content-center justify-center absolute  p-4 bg-black rounded-full h-6 w-6",style:{top:"20px",right:"20px"}},r.createElement("button",{type:"button",onClick:()=>y(!1),className:"text-white text-md "},"X")),r.createElement("div",{className:"flex flex-col gap-4 w-full bg-white p-6 rounded-lg top-2 overflow-y-auto mt-10",style:{maxHeight:"90vh",maxWidth:"85vh"}},r.createElement(C,{setFilter:f,filter:e,minPrice:d??0,maxPrice:m??0,categories:x,tags:b,attribute_values:Object.values(k),selected_category:c,tag_id:_}))))))};O((d,m)=>{T(d).render(r.createElement(J,{...m}))});
